---
title: "Настройка роутера Keenetic в качестве WireGuard сервера"
date: "2022-02-07"
categories: 
  - Network-Equipment
  - Security-System
tags: 
  - "keenetic"
  - "vpn"
  - "wireguard"
  - "router"
image:
  path: /commons/penguins.png
  alt: "Настройка роутера Keenetic в качестве WireGuard сервера"
---

> Поддержка **WireGuard VPN** реализована для актуальных моделей Keenetic, начиная с выпусков KeeneticOS версии 3.3
{: .prompt-tip }

## Подготовка

Для начала добавляем в роутер Keenetic поддержку WigreGuard

- Управление > Общие настройки > Изменить набор компонентов

![](/assets/img/posts/2022/02/07/image.png){: w="300" }
_Общие настройки_

В строке поиска вводим WireGuard и устанавливаем компонент

![](/assets/img/posts/2022/02/07/image-1.png){: w="300" }
_Компоненты операционной системы_

## Настройка WireGuard сервера

Переходим к настройкам WireGuard-сервера.

- Интернет > Другие подключения > Добавить подключение

Создаем новое подключение

![](/assets/img/posts/2022/02/07/image-3.png){: w="300" }
_Добавить подключение_

Называем его, к примеру `WG-S` (WireGuard Server)

Задаем следующие параметры

```
Название: WG-S (любое название)
Жмем на кнопку "Генерация пары ключей", публичный ключ понадобится далее
Адрес: 172.16.31.1/24 - наш терминальный ip WireGuard сервера
Порт: к примеру 12345
```

![](/assets/img/posts/2022/02/07/image-4.png){: w="300" }
_Настройки подключения_

Чуть ниже будет кнопка `Добавить пир`, нажимаем её и задаем параметры пира

```
Имя пира: любое понятное имя
Публичный ключ: получим при настройки клиента, чуть ниже
Разрешенные подсети: 172.16.31.2/32 - терминальный ip WireGuard клиента
Проверка активности: я ставлю 25 сек
```

![](/assets/img/posts/2022/02/07/image-5.png){: w="300" }
_Настройка пира_

## Настройка WireGuard клиента

Запускаем WireGuard на ПК и создаем новый туннель

```
Название: придумываем удобное название
Публичный ключ: генерируется сам. Копируем его и вставляем в шаге выше
PrivateKey: генерируется сам
Address: 172.16.31.2/32 - терминальный ip-адрес клиента

PublicKey: публичный ключ сервера
AllowedIPs: 172.16.31.1/32, 192.168.0.0/24 - разрешаем терминальный ip-адрес сервера и сетку в удаленном офисе
Endpoint: ip:port WireGuard серевера (к примеру 8.8.8.8:12345)
PersistentKeepalive: 25 сек, проверка активности
```

![](/assets/img/posts/2022/02/07/image-7.png){: w="300" }
_Настройка WireGuard клиента_

На этом настройка VPN клиента и сервера завершена.

## Настройка межсетевого экрана

Переходим в пункт меню

- Сетевые правила -> Межсетевой экран

Выбираем вкладку с названием нашего WireGuard `WG-S` и жмем `Добавить правило`

![](/assets/img/posts/2022/02/07/image-8.png){: w="300" }
_Межсетевой экран_

Задаем удобное описание, меняем протокол на IP и включаем правило

![](/assets/img/posts/2022/02/07/image-9.png){: w="300" }
_Правило межсетевого экрана_

На этом настройка завершена.  
Включаем WireGuard сервер на роутере Keenetic, подключаемся клиентом и проверяем доступность удаленных машин.
