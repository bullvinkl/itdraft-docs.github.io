---
title: "Настройка роутера Keenetic в качестве Wireguard сервера"
date: "2022-02-07"
categories: 
  - Network-Equipment
  - Security-System
tags: 
  - "keenetic"
  - "vpn"
  - "wireguard"
  - "router"
image:
  path: /commons/penguins.png
  alt: "Настройка роутера Keenetic в качестве Wireguard сервера"
---

> Поддержка **WireGuard VPN** реализована для актуальных моделей Keenetic, начиная с выпусков KeeneticOS версии 3.3
{: .prompt-tip }

## Подготовка

Для начала добавляем в роутер Keenetic поддержку wigreguard

```
Управление -> Общие настройки -> Изменить набор компонентов
```

[![](/assets/img/posts/2022/02/07/image.png){: w="300" }

В строке поиска вводим Wireguard и устанавливаем компонент

[![](/assets/img/posts/2022/02/07/image-1.png){: w="300" }

## Настройка Wireguard сервера

Переходим к настройкам Wireguard-сервера.

```
Интернет -> Другие подключения -> Добавить подключение
```

Создаем новое подключение

[![](/assets/img/posts/2022/02/07/image-3.png){: w="300" }

Называем его, к примеру WG-S (Wireguard server)

Задаем следующие параметры

```
Название: WG-S (любое название)
Жмем на кнопку "Генерация пары ключей", публичный ключ понадобится далее
Адрес: 172.16.31.1/24 - наш терминальный ip Wireguard сервера
Порт: к примеру 12345
```

[![](/assets/img/posts/2022/02/07/image-4.png){: w="300" }

Чуть ниже будет кнопка "Добавить пир", нажимаем её и задаем параметры пира

```
Имя пира: любое понятное имя
Публичный ключ: получим при настройки клиента, чуть ниже
Разрешенные подсети: 172.16.31.2/32 - терминальный ip wireguard клиента
Проверка активности: я ставлю 25 сек
```

[![](/assets/img/posts/2022/02/07/image-5.png){: w="300" }

## Настройка Wireguard клиента

Запускаем Wireguard на ПК и создаем новый туннель

```
Название: придумываем удобное название
Публичный ключ: генерится сам. Копируем его и вставляем в шаге выше
PrivateKey: генерится сам
Address: 172.16.31.2/32 - терминальный ip-адрес клиента

PublicKey: публичный ключ сервера
AllowedIPs: 172.16.31.1/32, 192.168.0.0/24 - разрешаем терминальный ip-адрес сервера и сетку в удаленном офисе
Endpoint: ip:port wireuard серевера (к примеру 8.8.8.8:12345)
PersistentKeepalive: 25 сек, проверка активности
```

[![](/assets/img/posts/2022/02/07/image-7.png){: w="300" }

На этом настройка VPN клиента и сервера завершена.

## Настройка межсетевого экрана

Переходим в пункт меню

```
Сетевые правила -> Межсетевой экран
```

Выбираем вкладку с названием нашего Wireguard (WG-S) и жмем "Добавить правило"

[![](/assets/img/posts/2022/02/07/image-8.png){: w="300" }

Задаем удобное описание, меняем протокол на IP и включаем правило

[![](/assets/img/posts/2022/02/07/image-9.png){: w="300" }

На этом настройка завершена.  
Включаем Wireguard сервер на роутере Keenetic, подключаемся клиентом и проверяем доступность удаленных машин.
